<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New York Mets Fan Hub</title>
    <!-- Tailwind CSS CDN -->
    <script src="[https://cdn.tailwindcss.com](https://cdn.tailwindcss.com)"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0c0c0c; /* Dark background */
            color: #e0e0e0; /* Light text color */
        }
        .container {
            max-width: 1200px;
            margin: auto;
            padding: 1.5rem;
        }
        .header {
            background-color: #002D72; /* Mets Blue */
            color: white;
            padding: 1.5rem;
            text-align: center;
            border-radius: 0.75rem; /* Rounded corners */
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .section-title {
            color: #FF5910; /* Mets Orange */
            font-size: 1.875rem; /* text-3xl */
            font-weight: 700; /* font-bold */
            margin-bottom: 1.5rem;
            text-align: center;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #FF5910;
        }
        .card {
            background-color: #1a1a1a; /* Darker card background */
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }
        .table-container {
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #333; /* Darker border */
        }
        th {
            background-color: #002D72; /* Mets Blue for table headers */
            color: white;
            font-weight: 600; /* font-semibold */
        }
        tr:hover {
            background-color: #2a2a2a; /* Slightly lighter on hover */
        }
        .score-card {
            display: flex;
            justify-content: space-around;
            align-items: center;
            font-size: 2.25rem; /* text-4xl */
            font-weight: 800; /* font-extrabold */
            padding: 2rem;
            background: linear-gradient(135deg, #002D72, #FF5910); /* Gradient background */
            color: white;
            border-radius: 0.75rem;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
            margin-bottom: 2rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        .score-team {
            text-align: center;
        }
        .score-divider {
            margin: 0 1rem;
        }
        .game-status {
            font-size: 1.25rem; /* text-xl */
            font-weight: 600;
            margin-top: 1rem;
            text-align: center;
            color: #e0e0e0;
        }
        .team-logo {
            width: 60px;
            height: 60px;
            object-fit: contain;
            margin: 0 auto 0.5rem auto;
            display: block;
        }
        @media (max-width: 768px) {
            .score-card {
                flex-direction: column;
                font-size: 1.5rem;
                padding: 1.5rem;
            }
            .score-divider {
                margin: 1rem 0;
            }
            .team-logo {
                width: 40px;
                height: 40px;
            }
            .header h1 {
                font-size: 2rem;
            }
            .section-title {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1 class="text-4xl font-extrabold mb-2">New York Mets Fan Hub</h1>
            <p class="text-xl">Your ultimate source for Mets scores, schedules, and standings!</p>
        </header>

        <!-- Current Score Section -->
        <section class="card">
            <h2 class="section-title">Current Game Score</h2>
            <div id="current-score" class="score-card">
                <!-- Dynamic content will be loaded here by JavaScript -->
                <div class="score-team">
                    <img src="[https://placehold.co/60x60/002D72/FFFFFF?text=NYM](https://placehold.co/60x60/002D72/FFFFFF?text=NYM)" alt="Mets Logo" class="team-logo">
                    <span id="home-team-name">New York Mets</span>
                    <br>
                    <span id="home-team-score">--</span>
                </div>
                <div class="score-divider">-</div>
                <div class="score-team">
                    <img src="[https://placehold.co/60x60/808080/FFFFFF?text=OPP](https://placehold.co/60x60/808080/FFFFFF?text=OPP)" alt="Opponent Logo" class="team-logo">
                    <span id="away-team-name">Opponent</span>
                    <br>
                    <span id="away-team-score">--</span>
                </div>
            </div>
            <p id="game-status" class="game-status">Loading live game status...</p>
        </section>

        <!-- Upcoming Games Section -->
        <section class="card">
            <h2 class="section-title">Upcoming Mets Games</h2>
            <div class="table-container">
                <table id="upcoming-games-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Time (EDT)</th>
                            <th>Opponent</th>
                            <th>Location</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Upcoming games will be populated here by JavaScript -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Past Games Section -->
        <section class="card">
            <h2 class="section-title">Past Mets Game Results</h2>
            <div class="table-container">
                <table id="past-games-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Opponent</th>
                            <th>Score</th>
                            <th>Result</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Past games will be populated here by JavaScript -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Standings Section -->
        <section class="card">
            <h2 class="section-title">MLB Standings</h2>

            <h3 class="text-xl font-semibold text-white mb-4 text-center">NL East Standings</h3>
            <div class="table-container mb-8">
                <table id="nl-east-standings-table">
                    <thead>
                        <tr>
                            <th>Team</th>
                            <th>W</th>
                            <th>L</th>
                            <th>PCT</th>
                            <th>GB</th>
                            <th>STRK</th>
                            <th>L10</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- NL East Standings populated by JavaScript -->
                    </tbody>
                </table>
            </div>

            <h3 class="text-xl font-semibold text-white mb-4 text-center">AL East Standings</h3>
            <div class="table-container mb-8">
                <table id="al-east-standings-table">
                    <thead>
                        <tr>
                            <th>Team</th>
                            <th>W</th>
                            <th>L</th>
                            <th>PCT</th>
                            <th>GB</th>
                            <th>STRK</th>
                            <th>L10</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- AL East Standings populated by JavaScript -->
                    </tbody>
                </table>
            </div>

            <h3 class="text-xl font-semibold text-white mb-4 text-center">NL Central Standings</h3>
            <div class="table-container mb-8">
                <table id="nl-central-standings-table">
                    <thead>
                        <tr>
                            <th>Team</th>
                            <th>W</th>
                            <th>L</th>
                            <th>PCT</th>
                            <th>GB</th>
                            <th>STRK</th>
                            <th>L10</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- NL Central Standings populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </section>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Your API key is not needed for MLB Stats API, but kept here for reference if you switch back
            const API_KEY = "9920e2c5f46d63b74e44752cc2392422"; 
            const MLB_STATS_API_HOST = "statsapi.mlb.com";
            // Mets Team ID on MLB Stats API is 121 (for New York Mets)
            const METS_TEAM_ID = 121; 

            // Mock Data for Fallback (same as before)
            const mockUpcomingGames = [
                { date: "Sun, Jun 15, 2025", time: "01:40 PM", opponent: "Tampa Bay Rays", location: "Citi Field, New York" },
                { date: "Tue, Jun 17, 2025", time: "07:15 PM", opponent: "@ Atlanta Braves", location: "Truist Park, Atlanta" },
                { date: "Wed, Jun 18, 2025", time: "07:15 PM", opponent: "@ Atlanta Braves", location: "Truist Park, Atlanta" },
            ];

            const mockPastGames = [
                { date: "Fri, Jun 13, 2025", opponent: "Tampa Bay Rays", score: "5 - 7", result: "L" },
                { date: "Thu, Jun 12, 2025", opponent: "Washington Nationals", score: "4 - 3", result: "W" },
                { date: "Wed, Jun 11, 2025", opponent: "Washington Nationals", score: "5 - 0", result: "W" },
            ];

            const mockNLEastStandings = [
                { team: "New York Mets", W: 45, L: 25, PCT: ".643", GB: "-", STRK: "L1", L10: "7-3" },
                { team: "Philadelphia Phillies", W: 40, L: 29, PCT: ".580", GB: "4.5", STRK: "W2", L10: "4-6" },
                { team: "Atlanta Braves", W: 30, L: 38, PCT: ".441", GB: "14.0", STRK: "W2", L10: "3-7" },
            ];

            const mockALEastStandings = [
                { team: "New York Yankees", W: 42, L: 26, PCT: ".618", GB: "-", STRK: "L1", L10: "6-4" },
                { team: "Toronto Blue Jays", W: 38, L: 31, PCT: ".551", GB: "4.5", STRK: "L1", L10: "7-3" },
                { team: "Tampa Bay Rays", W: 37, L: 32, PCT: ".536", GB: "5.5", STRK: "W1", L10: "7-3" },
            ];

            const mockNLCentralStandings = [
                { team: "Chicago Cubs", W: 42, L: 28, PCT: ".600", GB: "-", STRK: "L1", L10: "4-6" },
                { team: "Milwaukee Brewers", W: 38, L: 33, PCT: ".535", GB: "4.5", STRK: "W2", L10: "5-5" },
                { team: "St. Louis Cardinals", W: 36, L: 34, PCT: ".514", GB: "6.0", STRK: "L6", L10: "3-7" },
            ];


            // Helper to fetch data from MLB Stats API
            async function fetchData(path, params = {}) {
                const queryString = new URLSearchParams(params).toString();
                const url = `https://${MLB_STATS_API_HOST}/api/v1${path}?${queryString}`;
                console.log(`Fetching from MLB Stats API: ${url}`); 
                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error(`HTTP error! status: ${response.status}, message: ${errorText} for URL: ${url}`);
                        return null; 
                    }
                    const data = await response.json();
                    console.log(`MLB Stats API response for ${path}:`, data); 
                    // MLB Stats API responses vary, check for common indicators of no data
                    if ((data.totalItems !== undefined && data.totalItems === 0) || 
                        (data.records && data.records.length === 0) || 
                        (data.dates && data.dates.length === 0) ||
                        (Object.keys(data).length === 0 && data.constructor === Object)) {
                        console.warn(`MLB Stats API returned empty data for ${path} with params:`, params);
                        return []; 
                    }
                    return data;
                } catch (error) {
                    console.error(`Error fetching data from MLB Stats API ${path}:`, error);
                    return null; 
                }
            }

            // Function to update current game score using MLB Stats API
            async function updateCurrentScore() {
                const homeTeamName = document.getElementById('home-team-name');
                const awayTeamName = document.getElementById('away-team-name');
                const homeTeamScore = document.getElementById('home-team-score');
                const awayTeamScore = document.getElementById('away-team-score');
                const gameStatus = document.getElementById('game-status');

                gameStatus.textContent = "Loading live game status...";

                const today = new Date();
                const year = today.getFullYear();
                const month = String(today.getMonth() + 1).padStart(2, '0');
                const day = String(today.getDate()).padStart(2, '0');
                const formattedDate = `${year}-${month}-${day}`;

                const scheduleData = await fetchData('/schedule', {
                    date: formattedDate,
                    sportId: 1 // MLB
                });

                if (scheduleData && scheduleData.dates && scheduleData.dates.length > 0) {
                    const gamesToday = scheduleData.dates[0].games;
                    const metsGame = gamesToday.find(game => 
                        (game.teams.home.team.id === METS_TEAM_ID || game.teams.away.team.id === METS_TEAM_ID) &&
                        (game.status.codedGameState === "I" || game.status.codedGameState === "P" || game.status.codedGameState === "D") // I: In Progress, P: Pre-Game, D: Delayed
                    );

                    if (metsGame) {
                        homeTeamName.textContent = metsGame.teams.home.team.name || "Unknown";
                        awayTeamName.textContent = metsGame.teams.away.team.name || "Unknown";
                        homeTeamScore.textContent = metsGame.teams.home.score !== undefined ? metsGame.teams.home.score : "--";
                        awayTeamScore.textContent = metsGame.teams.away.score !== undefined ? metsGame.teams.away.score : "--";
                        
                        let currentStatus = metsGame.status.detailedState;
                        if (metsGame.status.codedGameState === "I" && metsGame.inningInfo) {
                            currentStatus = `${metsGame.inningInfo.inningHalf} ${metsGame.inningInfo.currentInning}${getOrdinalSuffix(metsGame.inningInfo.currentInning)}`;
                        }
                        gameStatus.textContent = `Live: ${currentStatus}`;
                    } else {
                        gameStatus.textContent = "No live Mets game currently.";
                        homeTeamName.textContent = "New York Mets";
                        awayTeamName.textContent = "Opponent";
                        homeTeamScore.textContent = "--";
                        awayTeamScore.textContent = "--";
                    }
                } else {
                    gameStatus.textContent = "No games scheduled for today or data unavailable from MLB Stats API.";
                    homeTeamName.textContent = "New York Mets";
                    awayTeamName.textContent = "Opponent";
                    homeTeamScore.textContent = "--";
                    awayTeamScore.textContent = "--";
                }
            }

            // Helper for ordinal suffixes (1st, 2nd, 3rd, etc.)
            function getOrdinalSuffix(i) {
                const j = i % 10, k = i % 100;
                if (j === 1 && k !== 11) return "st";
                if (j === 2 && k !== 12) return "nd";
                if (j === 3 && k !== 13) return "rd";
                return "th";
            }


            // Function to populate games tables using MLB Stats API
            async function populateGames(type) {
                const tableBody = document.querySelector(`#${type}-games-table tbody`);
                tableBody.innerHTML = ''; 

                const today = new Date();
                const year = today.getFullYear();
                
                let gamesFromApi;
                const currentDate = new Date(); // Use a fresh date object for each call to avoid mutation issues

                if (type === 'upcoming') {
                    const futureDate = new Date();
                    futureDate.setDate(currentDate.getDate() + 30); // Next 30 days

                    const formattedToday = `${year}-${String(currentDate.getMonth() + 1).padStart(2, '0')}-${String(currentDate.getDate()).padStart(2, '0')}`;
                    const formattedFutureDate = `${futureDate.getFullYear()}-${String(futureDate.getMonth() + 1).padStart(2, '0')}-${String(futureDate.getDate()).padStart(2, '0')}`;

                    const scheduleData = await fetchData('/schedule', {
                        startDate: formattedToday,
                        endDate: formattedFutureDate,
                        teamId: METS_TEAM_ID,
                        sportId: 1, // MLB
                        // Add gameStatus to filter, if API supports
                        // e.g., gameStatus: 'P' (Pre-Game), 'S' (Scheduled)
                    });
                    
                    if (scheduleData && scheduleData.dates) {
                        gamesFromApi = scheduleData.dates.flatMap(dateEntry => 
                            dateEntry.games.filter(game => 
                                (game.teams.home.team.id === METS_TEAM_ID || game.teams.away.team.id === METS_TEAM_ID) &&
                                (game.status.codedGameState === "S" || game.status.codedGameState === "P" || game.status.codedGameState === "D") // Scheduled, Pre-Game, Delayed
                            )
                        );
                    } else {
                        gamesFromApi = [];
                    }

                } else if (type === 'past') {
                    const pastDate = new Date();
                    pastDate.setDate(currentDate.getDate() - 7); // Last 7 days

                    const yesterday = new Date();
                    yesterday.setDate(currentDate.getDate() - 1);

                    const formattedPastDate = `${pastDate.getFullYear()}-${String(pastDate.getMonth() + 1).padStart(2, '0')}-${String(pastDate.getDate()).padStart(2, '0')}`;
                    const formattedYesterday = `${yesterday.getFullYear()}-${String(yesterday.getMonth() + 1).padStart(2, '0')}-${String(yesterday.getDate()).padStart(2, '0')}`;

                    const scheduleData = await fetchData('/schedule', {
                        startDate: formattedPastDate,
                        endDate: formattedYesterday,
                        teamId: METS_TEAM_ID,
                        sportId: 1, // MLB
                        // Add gameStatus to filter, if API supports
                        // e.g., gameStatus: 'F' (Final)
                    });

                    if (scheduleData && scheduleData.dates) {
                        gamesFromApi = scheduleData.dates.flatMap(dateEntry => 
                            dateEntry.games.filter(game => 
                                (game.teams.home.team.id === METS_TEAM_ID || game.teams.away.team.id === METS_TEAM_ID) &&
                                (game.status.codedGameState === "F" || game.status.codedGameState === "O") // F: Final, O: Completed (Official)
                            )
                        );
                    } else {
                        gamesFromApi = [];
                    }
                }

                const gamesToDisplay = (gamesFromApi && gamesFromApi.length > 0) ? gamesFromApi : (type === 'upcoming' ? mockUpcomingGames : mockPastGames);

                if (gamesToDisplay && gamesToDisplay.length > 0) {
                    if (gamesFromApi && gamesFromApi.length > 0) { // Only sort if it's API data
                        gamesToDisplay.sort((a, b) => new Date(a.gameDate) - new Date(b.gameDate)); 
                    }
                    
                    gamesToDisplay.forEach(game => {
                        const row = tableBody.insertRow();
                        
                        // Determine if it's mock data or API data by checking property existence
                        const isApiData = game.gamePk !== undefined;

                        let gameDate, gameTime, opponentName, location, metsScore, opponentScore, result;

                        if (isApiData) {
                            const gameDateTime = new Date(game.gameDate);
                            gameDate = gameDateTime.toLocaleDateString('en-US', { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' });
                            gameTime = gameDateTime.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });

                            opponentName = (game.teams.home.team.id === METS_TEAM_ID ? game.teams.away.team.name : game.teams.home.team.name) || "Unknown Opponent";
                            if (game.teams.home.team.id !== METS_TEAM_ID) {
                                opponentName = `@ ${opponentName}`; // Prepend @ for away games
                            }
                            location = (game.venue && game.venue.name) || "Unknown Venue";

                            if (type === 'past') {
                                metsScore = (game.teams.home.team.id === METS_TEAM_ID ? game.teams.home.score : game.teams.away.score);
                                opponentScore = (game.teams.home.team.id === METS_TEAM_ID ? game.teams.away.score : game.teams.home.score);
                                result = (metsScore > opponentScore) ? 'W' : (metsScore < opponentScore ? 'L' : 'TBD');
                            }
                        } else { // Mock data
                            gameDate = game.date;
                            gameTime = game.time;
                            opponentName = game.opponent;
                            location = game.location;
                            metsScore = (game.score && game.score.split(' - ')[0]) || '--';
                            opponentScore = (game.score && game.score.split(' - ')[1]) || '--';
                            result = game.result;
                        }


                        if (type === 'upcoming') {
                            row.insertCell().textContent = gameDate;
                            row.insertCell().textContent = gameTime;
                            row.insertCell().textContent = opponentName;
                            row.insertCell().textContent = location;
                        } else if (type === 'past') {
                            row.insertCell().textContent = gameDate;
                            row.insertCell().textContent = opponentName;
                            row.insertCell().textContent = `${metsScore || '--'} - ${opponentScore || '--'}`;
                            row.insertCell().textContent = result;
                        }
                    });
                } else {
                    const row = tableBody.insertRow();
                    const cell = row.insertCell();
                    cell.colSpan = 4;
                    cell.textContent = `No ${type} games found or data unavailable from MLB Stats API.`;
                    cell.className = "text-center py-4";
                }
            }

            // Function to populate standings tables using MLB Stats API
            async function populateStandings() {
                const standingsFromApi = await fetchData('/standings', {
                    leagueId: 103, // National League
                    season: new Date().getFullYear(),
                    standingsTypes: 'regularSeason',
                    // The API returns all divisions within a league
                });
                
                const alStandingsFromApi = await fetchData('/standings', {
                    leagueId: 104, // American League
                    season: new Date().getFullYear(),
                    standingsTypes: 'regularSeason',
                });


                const nlEastTableBody = document.querySelector('#nl-east-standings-table tbody');
                const alEastTableBody = document.querySelector('#al-east-standings-table tbody');
                const nlCentralTableBody = document.querySelector('#nl-central-standings-table tbody'); 

                nlEastTableBody.innerHTML = '';
                alEastTableBody.innerHTML = '';
                nlCentralTableBody.innerHTML = '';

                const populateSingleStandingsTable = (tableBody, data, divisionName) => {
                    if (data && data.length > 0) {
                        data.sort((a, b) => a.team.name.localeCompare(b.team.name)); // Sort alphabetically for consistency if no rank
                        
                        data.forEach(teamRecord => {
                            const row = tableBody.insertRow();
                            row.insertCell().textContent = teamRecord.team.name || "Unknown Team";
                            row.insertCell().textContent = teamRecord.wins || '--';
                            row.insertCell().textContent = teamRecord.losses || '--';
                            row.insertCell().textContent = teamRecord.winningPercentage !== null ? parseFloat(teamRecord.winningPercentage).toFixed(3) : '--';
                            row.insertCell().textContent = teamRecord.gamesBack || '-';
                            row.insertCell().textContent = teamRecord.streak.streakCode || '--'; // e.g., W3, L2
                            row.insertCell().textContent = teamRecord.lastTenGames || '--'; // Not directly available, would need calculation or different endpoint
                        });
                    } else {
                        const row = tableBody.insertRow();
                        const cell = row.insertCell();
                        cell.colSpan = 7;
                        cell.textContent = `${divisionName} Standings data unavailable from MLB Stats API.`;
                        cell.className = "text-center py-4";
                    }
                };
                
                if (standingsFromApi && standingsFromApi.records) {
                    const nlEastData = standingsFromApi.records.find(record => record.division.id === 203)?.teamRecords; // NL East ID
                    if (nlEastData) {
                         populateSingleStandingsTable(nlEastTableBody, nlEastData, "NL East");
                    } else {
                        populateSingleStandingsTable(nlEastTableBody, mockNLEastStandings, "NL East (Fallback)");
                    }

                    const nlCentralData = standingsFromApi.records.find(record => record.division.id === 204)?.teamRecords; // NL Central ID
                    if (nlCentralData) {
                         populateSingleStandingsTable(nlCentralTableBody, nlCentralData, "NL Central");
                    } else {
                        populateSingleStandingsTable(nlCentralTableBody, mockNLCentralStandings, "NL Central (Fallback)");
                    }
                } else {
                    populateSingleStandingsTable(nlEastTableBody, mockNLEastStandings, "NL East (Fallback)");
                    populateSingleStandingsTable(nlCentralTableBody, mockNLCentralStandings, "NL Central (Fallback)");
                }

                if (alStandingsFromApi && alStandingsFromApi.records) {
                     const alEastData = alStandingsFromApi.records.find(record => record.division.id === 201)?.teamRecords; // AL East ID
                    if (alEastData) {
                        populateSingleStandingsTable(alEastTableBody, alEastData, "AL East");
                    } else {
                        populateSingleStandingsTable(alEastTableBody, mockALEastStandings, "AL East (Fallback)");
                    }
                } else {
                    populateSingleStandingsTable(alEastTableBody, mockALEastStandings, "AL East (Fallback)");
                }
            }


            async function initializeApp() {
                await updateCurrentScore();
                await populateGames('upcoming');
                await populateGames('past');
                await populateStandings();
            }

            initializeApp();

            setInterval(initializeApp, 5 * 60 * 1000);
        });
    </script>
</body>
</html>
